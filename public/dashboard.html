<!DOCTYPE html>
<html>
<head>
<title>Dashboard</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = { darkMode: 'class' }
</script>
</head>
<body class="bg-gray-100 dark:bg-gray-900 min-h-screen p-6">

<div class="flex justify-between items-center">
<h1 class="text-3xl font-bold dark:text-white">üå± Carbon Dashboard</h1>
<button onclick="toggleDark()" class="bg-black text-white px-4 py-2 rounded">
Toggle Mode
</button>
</div>

<div class="mt-8 bg-white dark:bg-gray-800 p-6 rounded-xl shadow">
<h2 class="text-lg dark:text-white mb-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>

<label class="dark:text-white">‚ö° ‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡πÑ‡∏ü‡∏ü‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ (kWh)</label>
<input id="electricity" type="number" class="border p-2 w-full mb-3">

<label class="dark:text-white">üöó ‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á (km)</label>
<input id="transportKm" type="number" class="border p-2 w-full mb-3">

<label class="dark:text-white">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏¥‡∏ô‡∏ó‡∏≤‡∏á</label>
<select id="transportType" class="border p-2 w-full mb-3">
  <option value="car">‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</option>
  <option value="motorcycle">‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÑ‡∏ã‡∏Ñ‡πå</option>
  <option value="bus">‡∏£‡∏ñ‡πÄ‡∏°‡∏•‡πå</option>
  <option value="walk">‡πÄ‡∏î‡∏¥‡∏ô</option>
  <option value="bike">‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô</option>
</select>

<label class="dark:text-white">üçú ‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡∏ó‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
<select id="foodType" class="border p-2 w-full mb-3">
  <option value="noodle">‡∏Å‡πã‡∏ß‡∏¢‡πÄ‡∏ï‡∏µ‡πã‡∏¢‡∏ß</option>
  <option value="khaokamoo">‡∏Ç‡πâ‡∏≤‡∏ß‡∏Ç‡∏≤‡∏´‡∏°‡∏π</option>
  <option value="khaomankai">‡∏Ç‡πâ‡∏≤‡∏ß‡∏°‡∏±‡∏ô‡πÑ‡∏Å‡πà</option>
  <option value="khaomudaeng">‡∏Ç‡πâ‡∏≤‡∏ß‡∏´‡∏°‡∏π‡πÅ‡∏î‡∏á</option>
  <option value="kaprao">‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡∏Å‡∏∞‡πÄ‡∏û‡∏£‡∏≤</option>
  <option value="friedrice">‡∏Ç‡πâ‡∏≤‡∏ß‡∏ú‡∏±‡∏î‡πÑ‡∏Ç‡πà</option>
  <option value="padthai">‡∏ú‡∏±‡∏î‡πÑ‡∏ó‡∏¢</option>
  <option value="somtam">‡∏™‡πâ‡∏°‡∏ï‡∏≥</option>
  <option value="moo_ping">‡∏´‡∏°‡∏π‡∏õ‡∏¥‡πâ‡∏á + ‡∏Ç‡πâ‡∏≤‡∏ß‡πÄ‡∏´‡∏ô‡∏µ‡∏¢‡∏ß</option>
  <option value="mookrata">‡∏´‡∏°‡∏π‡∏Å‡∏£‡∏∞‡∏ó‡∏∞</option>
  <option value="shabu">‡∏ä‡∏≤‡∏ö‡∏π</option>
</select>

<button onclick="saveActivity()" 
class="bg-green-500 text-white p-2 rounded w-full">
‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
</button>

<p id="result" class="mt-4 text-green-500 font-bold"></p>
</div>

<div class="mt-8">
<h2 class="text-2xl dark:text-white">üèÜ Ranking</h2>
<div id="ranking"></div>
</div>

<script>
const username = localStorage.getItem("username");
if (!username) window.location = "login.html";

function toggleDark() {
  document.documentElement.classList.toggle("dark");
}

function saveActivity() {
  fetch("/api/add-activity", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      username,
      electricity: Number(document.getElementById("electricity").value),
      transportKm: Number(document.getElementById("transportKm").value),
      transportType: document.getElementById("transportType").value,
      foodType: document.getElementById("foodType").value
    })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById("result").innerText =
      "‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏•‡πà‡∏≠‡∏¢‡∏Ñ‡∏≤‡∏£‡πå‡∏ö‡∏≠‡∏ô " + data.total.toFixed(2) + " kg CO2";
    loadRanking();
  })
  .catch(err => {
    console.error(err);
    alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏ä‡πá‡∏Ñ server");
  });
}

function loadRanking() {
  fetch("/api/ranking")
  .then(res => res.json())
  .then(users => {
    const rankingDiv = document.getElementById("ranking");
    rankingDiv.innerHTML = "";

    users.forEach((u, i) => {
      rankingDiv.innerHTML += `
        <div class="bg-white dark:bg-gray-800 p-3 rounded shadow mt-2">
          ${i+1}. ${u.username} - ${u.totalCarbon} kg
        </div>`;
    });
  });
}

loadRanking();
</script>

</body>
</html>
